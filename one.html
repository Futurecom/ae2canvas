<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <style>
        html {
            width: 100%;
            height: 100%;
        }

        body {
            width: 100%;
            height: 100%;
            margin: 0;
            text-align: center;
            overflow: hidden;
            background: #000000;
        }

        #canvas1 {
            cursor: pointer;
            position: absolute;
            top: 0;
            left: 0;
            width: 1100px;
            max-width: 100%;
            background: url(img/grid.png) #ffffff;
        }

        canvas {
            width: 100%;
        }

        .btn-group {
            position: fixed;
            bottom: 20px;
            left: 20px;
        }

        input {
            position: absolute;
            width: 600px !important;
            left: 20px;
            right: 10%;
            bottom: 100px;
        }
    </style>
</head>
<body>
<div id="canvas1"></div>
<div class="btn-group">
    <button id="start" type="button" class="btn btn-default">
        <span class="glyphicon glyphicon-play"></span></button>
    <button id="stop" type="button" class="btn btn-default">
        <span class="glyphicon glyphicon-stop"></span></button>
    <button id="pause" type="button" class="btn btn-default">
        <span class="glyphicon glyphicon-pause"></span></button>
</div>
<input type="range" min="0" max="100" step="1" value="0">
<script>
    (function () {
        var lastTime = 0;
        var vendors = ['webkit', 'moz'];
        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
            window.cancelAnimationFrame =
                    window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
        }

        if (!window.requestAnimationFrame)
            window.requestAnimationFrame = function (callback, element) {
                var currTime = new Date().getTime();
                var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                var id = window.setTimeout(function () {
                            callback(currTime + timeToCall);
                        },
                        timeToCall);
                lastTime = currTime + timeToCall;
                return id;
            };

        if (!window.cancelAnimationFrame)
            window.cancelAnimationFrame = function (id) {
                clearTimeout(id);
            };
    }());

    (function () {

// prepare base perf object
        if (typeof window.performance === 'undefined') {
            window.performance = {};
        }

        if (!window.performance.now) {

            var nowOffset = Date.now();

            if (performance.timing && performance.timing.navigationStart) {
                nowOffset = performance.timing.navigationStart
            }

            window.performance.now = function now() {
                return Date.now() - nowOffset;
            }

        }

    })();
</script>
<script src="src/lib/stats.min.js"></script>
<script src="build/ae2canvas.js"></script>
<script>
    var stats, ani1, input, data;
    var step = 0;

    var isHD = ((window.matchMedia && (window.matchMedia('only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)').matches
    || window.matchMedia('only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)').matches))
    || (window.devicePixelRatio && window.devicePixelRatio > 1.3));

    function fetchJSONFile(path, callback) {
        var httpRequest = new XMLHttpRequest();
        httpRequest.onreadystatechange = function () {
            if (httpRequest.readyState === 4) {
                if (httpRequest.status === 200) {
                    var data = JSON.parse(httpRequest.responseText);
                    if (callback) callback(data);
                }
            }
        };
        httpRequest.open('GET', path);
        httpRequest.send();
    }

    function loop(time) {
        requestAnimationFrame(loop);
        if (!time) time = performance.now();
        AE2Canvas.update(time);
        stats.update();

        if (ani1) input.value = ani1.getStep();
    }

    input = document.querySelector('input');

    stats = new Stats();
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.top = '0';
    stats.domElement.style.left = '0';

    loop();

    fetchJSONFile('json/animation.json', function (result) {
        data = result;
        createAni();
    });

    function createAni() {
        if (ani1) ani1.destroy();
        ani1 = new AE2Canvas.Animation({
            data      : data,
            hd        : isHD,
            loop      : true,
            reversed  : location.hash.indexOf('reversed') > -1,
            onComplete: function () {
            }
        });
        document.getElementById('canvas1').appendChild(ani1.canvas);
        ani1.resize();
    }

    window.addEventListener('resize', function () {
        if (ani1) ani1.resize();
    });

    document.getElementsByTagName('body')[0].appendChild(stats.domElement);

    document.getElementById('canvas1').addEventListener('mouseenter', function () {
        ani1.play();
    });

    document.getElementById('canvas1').addEventListener('mouseleave', function () {
        ani1.pause();
    });

    document.getElementById('start').addEventListener('click', function () {
        ani1.play();
    });
    document.getElementById('stop').addEventListener('click', function () {
        ani1.stop();
    });
    document.getElementById('pause').addEventListener('click', function () {
        ani1.pause();
    });

    window.gotoAndPlay = function (id) {
        ani1.gotoAndPlay(id);
    };

    window.gotoAndStop = function (id) {
        ani1.gotoAndStop(id);
    };

    input.addEventListener('input', function () {
        ani1.setStep(this.value);
    });

    window.addEventListener('wheel', function (event) {
        step -= event.wheelDelta / 120;
        step = Math.max(0, Math.min(100, step));
        ani1.setStep(step);
    });

</script>
</body>
</html>